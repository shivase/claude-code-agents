# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際のClaude Code (claude.ai/code) 向けガイダンスを提供します。

## プロジェクト概要

tmuxセッション内で動作するAIエージェントにメッセージを送信するGoベースのコマンドラインアプリケーションです。統合監視画面（6ペインのtmuxセッション）と個別エージェントセッションの両方をサポートしています。

## 共通コマンド

### ビルドとテスト
```bash
# アプリケーションをビルド
make build

# テストを実行
make test

# コードをフォーマット
make fmt

# linterを実行
make lint

# 開発用ビルド（race detector付き）
make dev-build

# システムPATHにインストール
make install

# システムPATHからアンインストール
make uninstall

# ビルド成果物をクリーンアップ
make clean

# Goモジュールを更新
make mod-update
```

### アプリケーションの実行
```bash
# ビルドディレクトリから実行
make run

# ビルド後に直接実行
./build/send-agent --help
```

## アーキテクチャ

### モジュール構造
- `main.go` - Cobra CLIセットアップとコマンド定義のエントリーポイント
- `internal/` - コアビジネスロジックパッケージ
  - `models.go` - データ構造、定数、エージェント定義
  - `sender.go` - メッセージ送信ロジックとバリデーション
  - `session.go` - セッション管理とエージェント一覧
  - `tmux.go` - tmux連携ユーティリティ

### 主要コンポーネント

1. **エージェントシステム**: 6つの定義済みエージェント（po、manager、dev1-dev4）をサポート
2. **セッション管理**: 2つのモード
   - 統合監視（6ペインのtmuxセッション）
   - 個別エージェントセッション（エージェント毎の独立したtmuxセッション）
3. **メッセージ配信**: タイミング制御と入力クリア機能付きのtmux send-keysを使用

### エージェント定義
- `po`: プロダクトオーナー（製品責任者）
- `manager`: プロジェクトマネージャー（柔軟なチーム管理）
- `dev1-dev4`: 実行エージェント（柔軟な役割対応）

### セッション検出ロジック
- 優先度1: 6ペインの統合セッション
- フォールバック: AI関連キーワード（ai、claude、agent）を含むセッション
- パターンマッチング: `-agent`サフィックス付きの個別エージェントセッション

## 開発ノート

### 依存関係
- `github.com/spf13/cobra` - CLIフレームワーク
- 標準Goライブラリ（`os/exec`経由でのtmux連携）

### コード品質
- コード修正後は必ず `make lint` を実行してください
- 包括的なルールセットを持つgolangci-lintを使用
- gosecによるセキュリティlintを有効化

### 設定ファイル
- `.golangci.yaml` - セキュリティとコード品質ルールのlinter設定
- `Makefile` - 包括的なターゲットを持つビルド自動化

## コード修正ガイドライン

### 必須品質チェック
**重要**: コード修正後は必ず以下を実行してください：
```bash
make lint
make test
```
- 作業完了前にすべてのlintエラーを修正する
- lintエラーがあるコードは決してコミットしない
- テストは常に実行し、失敗しないことを確認する

### ドキュメント保守
**重要**: 変更時にこのCLAUDE.mdファイルを最新の状態に保ってください：
- モジュールの追加/削除時はアーキテクチャ説明を更新
- Makefileターゲット変更時はコマンドセクションを更新
- 利用可能エージェント変更時はエージェント定義を更新
- セッション処理変更時はセッション検出ロジックを更新
- 新しいGoモジュール追加時は依存関係を更新

これにより、将来のClaude Codeインスタンスがコードベースで正確なガイダンスを得られるようになります。
